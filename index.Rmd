---
title: "FFF KM"
---

```{r include=FALSE}
library(tidyverse)
library(readr)
library(readxl)
library(DT)
library(kableExtra)
library(ggplot2)
```



```{r import_data, include=FALSE}
### Import result dataset

## Import results from competitions

# Import result dataset from first competition
comp1 <- read_excel("C:/Users/AndrésLagerlöf/OneDrive - Andrés Lagerlöf Konsulttjänst AB/Övrigt/Fäktning/KM/KM_webb/fff_km/Result_no1.xlsx")
# View(comp1)

# Import result from competition no 2
comp2 <- read_excel("C:/Users/AndrésLagerlöf/OneDrive - Andrés Lagerlöf Konsulttjänst AB/Övrigt/Fäktning/KM/KM_webb/fff_km/Result_no2.xlsx")
# View(comp2)

# Import result from competition no 3
comp3 <- read_excel("C:/Users/AndrésLagerlöf/OneDrive - Andrés Lagerlöf Konsulttjänst AB/Övrigt/Fäktning/KM/KM_webb/fff_km/Result_no3.xlsx")
# View(comp3)

# Import result from competition no 4
comp4 <- read_excel("C:/Users/AndrésLagerlöf/OneDrive - Andrés Lagerlöf Konsulttjänst AB/Övrigt/Fäktning/KM/KM_webb/fff_km/Result_no4.xlsx")
# View(comp3)

```


```{r add_points, include=FALSE}
## Aggregate all datasets to one dataset
#For competitions 1-3
tot2 <- bind_rows(comp1, comp2, comp3, comp4)
# View(tot2)

## Calculate points per competition

# Add new variable "points"
tot <- tot2 %>% mutate(Points = case_when(
  Place == 1 ~ 25,
  Place == 2 ~ 22,
  Place == 3 ~ 19,
  Place == 4 ~ 17,
  Place == 5 ~ 15,
  Place == 6 ~ 13,
  Place == 7 ~ 12,
  Place == 8 ~ 11,
  Place == 9 ~ 10,
  Place == 10 ~ 9,
  Place == 11 ~ 8,
  Place == 12 ~ 7,
  Place == 13 ~ 6,
  Place == 14 ~ 5,
  Place == 15 ~ 4,
  Place == 16 ~ 3,
  Place == 17 ~ 2,
  TRUE ~ 1
))
 View(tot)


```


```{r prepare_data, include=FALSE}
##  Change format for output - create "pivot table" with points per competition
piv_comp_1to4 <- tot %>% 
  select(Name, CompNo, Place) %>% 
  spread(CompNo, Place) 
# View(piv_comp_1to3)

## Calculate grand total points for all competitions (1-4)
grand_tot_1to4 <- tot %>% group_by(Name) %>%
  summarise(sum_points = sum(Points))
# View(grand_tot_1to3)

# Create new piv df with totals column
res_1to4 <- piv_comp_1to4 %>%
  full_join(grand_tot_1to4, by = "Name") %>% 
  arrange(desc(sum_points))
 View(res_1to4)
```
## Resultat efter fjärde deltävlingen

Då har det hänt igen, ytterligare en KM-deltävling och denna gång med en bekant segrare – **Tor Forsse!** Efter två knappa uddastötsförluster tvingades Tor gå en avgörande match mot den gästande Jacob Stymne, och lyckades där med en 5-4 seger knipa den åtråvärda 1:a platsen.
Med tanke på att man får välja bort en deltävling har Tor nu lagt sig i pole position för att etsa in sitt namn i plaketten ytterligare en gång. Den sista deltävlingen blir avgörande.

Och slutligen, glöm inte att den sista KM-deltävling bakar loss **den 19 november**!  


```{r results_table, eval=FALSE, include=FALSE}
# Create a table with the DT package
res_1to4 %>%
  kable() %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left") %>% 
  footnote(general = "Detta är ställningen efter de första 4 deltävlingarna")
```
``
```{r Fine_table, echo=FALSE}
datatable(res_1to4,
          colnames = c("Namn" = "Name", "Deltävling 1" = 1, "Deltävling 2" = 2, "Deltävling 3" = 3, "Deltävling 4" = 4, "Poäng" = "sum_points"),
           caption = "Placering KM efter 2 deltävlingar", 
           options = list(pageLength = 23)) %>%
          formatStyle('Poäng',  color = 'steelblue', fontWeight = 'bold')
```



